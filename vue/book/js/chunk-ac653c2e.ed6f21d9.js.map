{"version":3,"sources":["webpack:///./src/views/mainViews/Home.vue?8d65","webpack:///src/views/mainViews/Home.vue","webpack:///./src/views/mainViews/Home.vue?48be","webpack:///./src/views/mainViews/Home.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","model","value","callback","$$v","active","expression","_l","item","index","key","tab","_v","_s","title","on","$event","setBookData","$set","v","i","shortTitle","booksData","ind","goDetail","_id","cover","latelyFollower","staticRenderFns","name","data","categoriesData","male","female","picture","epub","created","getCategoriesData","setHistoryData","methods","$toast","loading","message","forbidClick","duration","loadingType","axios","method","url","historyData","console","log","$store","state","bookrackStore","JSON","parse","map","localStorage","setItem","stringify","getIdData","getRankData","ids","axiosArr","push","all","then","result","ranking","gender","books","sort","b","a","dispatch","id","component"],"mappings":"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","file":"js/chunk-ac653c2e.ed6f21d9.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"home\"},[_c('div',{staticClass:\"search\"},[_c('van-icon',{attrs:{\"size\":\"24px\",\"name\":\"search\"}})],1),_c('van-tabs',{staticClass:\"tabs-box\",attrs:{\"sticky\":\"\",\"swipe-threshold\":\"3\",\"animated\":\"\",\"swipeable\":\"\",\"route\":\"\",\"title-inactive-color\":\"#999\"},model:{value:(_vm.active),callback:function ($$v) {_vm.active=$$v},expression:\"active\"}},_vm._l((_vm.categoriesData),function(item,index){return _c('van-tab',{key:index,attrs:{\"title\":item.tab}},[_c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"tuijian\"},[_c('h2',[_vm._v(_vm._s(item.title))]),_c('div',{staticClass:\"ranking-box clearfix\"},[_c('van-tabs',{staticClass:\"ranking-tabs\",on:{\"click\":function($event){return _vm.setBookData(index)}},model:{value:(item.active),callback:function ($$v) {_vm.$set(item, \"active\", $$v)},expression:\"item.active\"}},_vm._l((item.data),function(v,i){return _c('van-tab',{key:i,attrs:{\"title\":v.shortTitle}},[_c('div',{staticClass:\"books-box\"},_vm._l((_vm.booksData[index]),function(value,ind){return _c('div',{key:ind,staticClass:\"book clearfix\",on:{\"click\":function($event){return _vm.goDetail(value._id)}}},[_c('div',{staticClass:\"book-img fl\"},[_c('img',{staticClass:\"auto-img\",attrs:{\"src\":value.cover,\"alt\":\"\"}})]),_c('div',{staticClass:\"book-num fl\"},[_vm._v(_vm._s(ind+1))]),_c('div',{staticClass:\"book-text fl\"},[_c('div',{staticClass:\"book-title\"},[_vm._v(_vm._s(value.title))]),_c('div',{staticClass:\"book-hot\"},[_c('van-icon',{attrs:{\"name\":\"fire-o\"}}),_vm._v(\" \"+_vm._s(value.latelyFollower)+\" \")],1)])])}),0)])}),1)],1)])])])}),1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"home\">\n    <div class=\"search\">\n      <van-icon size=\"24px\" name=\"search\" />\n    </div>\n    <van-tabs\n      class=\"tabs-box\"\n      v-model=\"active\"\n      sticky\n      swipe-threshold=\"3\"\n      animated\n      swipeable\n      route\n      title-inactive-color=\"#999\"\n    >\n      <van-tab v-for=\"(item,index) in categoriesData\" :key=\"index\" :title=\"item.tab\">\n        <div class=\"content\">\n          <div class=\"tuijian\">\n            <h2>{{item.title}}</h2>\n            <div class=\"ranking-box clearfix\">\n              <van-tabs v-model=\"item.active\" @click=\"setBookData(index)\" class=\"ranking-tabs\">\n                <van-tab v-for=\"(v,i) in item.data\" :key=\"i\" :title=\"v.shortTitle\">\n                  <div class=\"books-box\">\n                    <div\n                      class=\"book clearfix\"\n                      v-for=\"(value,ind) in booksData[index]\"\n                      :key=\"ind\"\n                      @click=\"goDetail(value._id)\"\n                    >\n                      <div class=\"book-img fl\">\n                        <img class=\"auto-img\" :src=\"value.cover\" alt />\n                      </div>\n                      <div class=\"book-num fl\">{{ind+1}}</div>\n                      <div class=\"book-text fl\">\n                        <div class=\"book-title\">{{value.title}}</div>\n                        <div class=\"book-hot\">\n                          <van-icon name=\"fire-o\" />\n                          {{value.latelyFollower}}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </van-tab>\n              </van-tabs>\n            </div>\n          </div>\n        </div>\n      </van-tab>\n    </van-tabs>\n  </div>\n</template>\n\n<script>\nimport \"../../assets/less/home.less\";\nexport default {\n  name: \"Home\",\n  data() {\n    return {\n      active: 0,\n      // 排行榜数据\n      categoriesData: {\n        male: { tab: \"男生\", title: \"排行榜\", active: 0, data: [] },\n        female: { tab: \"女生\", title: \"排行榜\", active: 0, data: [] },\n        picture: { tab: \"漫画\", title: \"排行榜\", active: 0, data: [] },\n        epub: { tab: \"出版\", title: \"排行榜\", active: 0, data: [] },\n      },\n      // 展示区域书籍列表\n      booksData: {\n        epub: [],\n        female: [],\n        male: [],\n        picture: [],\n      },\n    };\n  },\n  created() {\n    this.getCategoriesData();\n    this.setHistoryData();\n  },\n  methods: {\n    // 获取分类数据\n    getCategoriesData() {\n      this.$toast.loading({\n        message: \"加载中...\",\n        forbidClick: true,\n        duration: 0,\n        loadingType: \"spinner\",\n      });\n\n      this.axios({\n        method: \"GET\",\n        url: \"/rank-category\",\n      })\n        .then((result) => {\n          this.$toast.clear();\n          for (let key in this.categoriesData) {\n            this.categoriesData[key].data = result.data[key].splice(0, 4);\n          }\n          this.setBookData();\n          // console.log(\"categoriesData==>\", this.categoriesData);\n          // console.log(\"booksData==>\", this.booksData);\n        })\n        .catch((err) => {\n          this.$toast.clear();\n        });\n    },\n\n    // 设置历史记录\n    setHistoryData() {\n      // 获取本地存储\n      let historyData = localStorage.getItem(\"BOOKHISTORY\");\n      // console.log(\"historyData==>\", historyData);\n      // 如果本地存储为null，添加本地存储\n      if (!historyData) {\n        historyData = [];\n        localStorage.setItem(\"BOOKHISTORY\", JSON.stringify(historyData));\n      } else {\n        // 如果存在本地存储，添加书架数据\n        console.log(\"historyData\", this.$store.state.bookrackStore.historyData);\n        if ((JSON.parse(historyData).length = 0)) return;\n        JSON.parse(historyData).map((v) => {\n          this.$store.dispatch(\"bookrackStore/addHistoryData\", v);\n        });\n        localStorage.setItem(\n          \"BOOKHISTORY\",\n          JSON.stringify(this.$store.state.bookrackStore.historyData)\n        );\n      }\n    },\n\n    // 根据id返回promise对象\n    getIdData(id) {\n      let url = \"/rank/\" + id;\n      return this.axios({\n        method: \"GET\",\n        url,\n      });\n    },\n\n    // 返回promise对象数组\n    getRankData(ids) {\n      let axiosArr = [];\n      ids.map((v) => {\n        axiosArr.push(this.getIdData(v));\n      });\n      // console.log(axiosArr);\n      return this.axios.all(axiosArr);\n    },\n\n    // 点击排行榜设置书籍列表\n    setBookData() {\n      let ids = [];\n      for (let key in this.categoriesData) {\n        ids.push(\n          this.categoriesData[key].data[this.categoriesData[key].active]._id\n        );\n      }\n      this.$toast.loading({\n        message: \"加载中...\",\n        forbidClick: true,\n        duration: 0,\n        loadingType: \"spinner\",\n      });\n      // 防止因为网络问题请求时间过长，提前停止加载动画\n      // setTimeout(() => {\n      //   this.$toast.clear();\n      // }, 500);\n      this.getRankData(ids).then((result) => {\n        this.$toast.clear();\n        for (let key in this.booksData) {\n          result.map((v) => {\n            if (v.data.ranking.gender == key) {\n              // 人气降序\n              v.data.ranking.books.sort((a, b) => {\n                return b.latelyFollower - a.latelyFollower;\n              });\n              this.booksData[key] = v.data.ranking.books.splice(0, 8);\n              this.booksData[key].map((v) => [\n                (v.cover = unescape(v.cover.slice(7))),\n              ]);\n            }\n          });\n        }\n      });\n    },\n\n    // 点击书籍，根据书籍id获取书籍详情，前往书籍详情页面\n    goDetail(id) {\n      this.$store.dispatch(\"detailStore/setBookIdListById\", id);\n      this.$toast.loading({\n        message: \"加载中...\",\n        forbidClick: true,\n        duration: 0,\n        loadingType: \"spinner\",\n      });\n      this.axios\n        .all([\n          this.axios({\n            method: \"GET\",\n            url: \"/book-info/\" + id,\n          }),\n          this.axios({\n            method: \"GET\",\n            url: \"/book-sources?view=summary&book=\" + id,\n          }),\n        ])\n        .then((result) => {\n          this.$toast.clear();\n          this.$store.dispatch(\"detailStore/setBookDetail\", result[0].data);\n          this.$store.dispatch(\n            \"detailStore/setBookOriginIdListById\",\n            result[1].data[0]._id\n          );\n          this.$router.push({ name: \"Detail\" });\n        })\n        .catch((err) => {\n          this.$toast.clear();\n        });\n    },\n  },\n};\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=44ac9a6a&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}