{"version":3,"sources":["webpack:///./src/views/Search.vue?940c","webpack:///src/views/Search.vue","webpack:///./src/views/Search.vue?0d6a","webpack:///./src/views/Search.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","onInput","onSearch","scopedSlots","_u","key","fn","back","proxy","_v","model","value","callback","$$v","expression","directives","name","rawName","status","_l","item","index","$event","changeValue","_s","goDetail","_id","cover","title","author","shortIntro","retentionRatio","staticRenderFns","data","hotwords","autowords","bookList","historywords","created","getHotwords","getHistorywords","methods","$router","go","JSON","parse","length","push","i","localStorage","setItem","stringify","axios","method","url","reslut","keywords","splice","unshift","$toast","loading","message","forbidClick","duration","loadingType","$store","dispatch","id","watch","val","component"],"mappings":"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","file":"js/chunk-5d32c477.7702e368.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"search\"},[_c('van-search',{attrs:{\"show-action\":\"\",\"placeholder\":\"请输入搜索关键词\"},on:{\"input\":_vm.onInput,\"search\":_vm.onSearch},scopedSlots:_vm._u([{key:\"left\",fn:function(){return [_c('div',{staticClass:\"back\",on:{\"click\":_vm.back}},[_c('van-icon',{attrs:{\"name\":\"arrow-left\"}})],1)]},proxy:true},{key:\"action\",fn:function(){return [_c('div',{on:{\"click\":_vm.onSearch}},[_vm._v(\"搜索\")])]},proxy:true}]),model:{value:(_vm.value),callback:function ($$v) {_vm.value=$$v},expression:\"value\"}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.status==0),expression:\"status==0\"}],staticClass:\"hotwords-box clearfix\"},[_c('p',[_vm._v(\"热门搜索\")]),_vm._l((_vm.hotwords),function(item,index){return _c('div',{key:index,staticClass:\"hotword fl\",on:{\"click\":function($event){return _vm.changeValue(item)}}},[_c('span',[_vm._v(_vm._s(index+1))]),_vm._v(\" \"+_vm._s(item)+\" \")])})],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.status==0),expression:\"status==0\"}],staticClass:\"historywords-box\"},[_c('p',[_vm._v(\"历史搜索\")]),_vm._l((_vm.historywords),function(item,index){return _c('div',{key:index,staticClass:\"historywords\",on:{\"click\":function($event){return _vm.changeValue(item)}}},[_vm._v(\" \"+_vm._s(item)+\" \")])})],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.status==1),expression:\"status==1\"}],staticClass:\"auto-complete\"},_vm._l((_vm.autowords),function(item,index){return _c('p',{key:index,on:{\"click\":function($event){return _vm.changeValue(item)}}},[_vm._v(_vm._s(item))])}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.status==2),expression:\"status==2\"}],staticClass:\"searchList\"},_vm._l((_vm.bookList),function(item,index){return _c('div',{key:index,staticClass:\"search-book\",on:{\"click\":function($event){return _vm.goDetail(item._id)}}},[_c('div',{staticClass:\"img-box\"},[_c('img',{staticClass:\"auto-img\",attrs:{\"src\":item.cover,\"alt\":\"\"}})]),_c('div',{staticClass:\"text-box\"},[_c('div',{staticClass:\"title-box\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(item.title))]),_c('div',{staticClass:\"author\"},[_vm._v(_vm._s(item.author))])]),_c('div',{staticClass:\"shorIntro\"},[_vm._v(_vm._s(item.shortIntro))]),_c('div',{staticClass:\"tags\"},[_c('span',[_vm._v(_vm._s(item.retentionRatio)+\"%留存\")])])])])}),0)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"search\">\r\n    <van-search\r\n      v-model=\"value\"\r\n      show-action\r\n      placeholder=\"请输入搜索关键词\"\r\n      @input=\"onInput\"\r\n      @search=\"onSearch\"\r\n    >\r\n      <template #left>\r\n        <div @click=\"back\" class=\"back\">\r\n          <van-icon name=\"arrow-left\" />\r\n        </div>\r\n      </template>\r\n      <template #action>\r\n        <div @click=\"onSearch\">搜索</div>\r\n      </template>\r\n    </van-search>\r\n    <div class=\"hotwords-box clearfix\" v-show=\"status==0\">\r\n      <p>热门搜索</p>\r\n      <div\r\n        class=\"hotword fl\"\r\n        v-for=\"(item,index) in hotwords\"\r\n        :key=\"index\"\r\n        @click=\"changeValue(item)\"\r\n      >\r\n        <span>{{index+1}}</span>\r\n        {{item}}\r\n      </div>\r\n    </div>\r\n    <div class=\"historywords-box\" v-show=\"status==0\">\r\n      <p>历史搜索</p>\r\n      <div class=\"historywords\" v-for=\"(item,index) in historywords\" :key=\"index\" @click=\"changeValue(item)\">\r\n        {{item}}\r\n      </div>\r\n    </div>\r\n    <div class=\"auto-complete\" v-show=\"status==1\">\r\n      <p v-for=\"(item,index) in autowords\" :key=\"index\" @click=\"changeValue(item)\">{{item}}</p>\r\n    </div>\r\n    <div class=\"searchList\" v-show=\"status==2\">\r\n      <div\r\n        v-for=\"(item,index) in bookList\"\r\n        :key=\"index\"\r\n        @click=\"goDetail(item._id)\"\r\n        class=\"search-book\"\r\n      >\r\n        <div class=\"img-box\">\r\n          <img class=\"auto-img\" :src=\"item.cover\" alt />\r\n        </div>\r\n        <div class=\"text-box\">\r\n          <div class=\"title-box\">\r\n            <div class=\"title\">{{item.title}}</div>\r\n            <div class=\"author\">{{item.author}}</div>\r\n          </div>\r\n          <div class=\"shorIntro\">{{item.shortIntro}}</div>\r\n          <div class=\"tags\">\r\n            <span>{{item.retentionRatio}}%留存</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport \"../assets/less/search.less\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      value: \"\",\r\n      hotwords: [],\r\n      autowords: [],\r\n      bookList: [],\r\n      historywords: [],\r\n      // 0：初始状态；1：键盘输入状态；2：已搜索状态\r\n      status: 0,\r\n    };\r\n  },\r\n  created() {\r\n    this.getHotwords();\r\n    this.getHistorywords();\r\n  },\r\n  methods: {\r\n    back() {\r\n      this.$router.go(-1);\r\n    },\r\n\r\n    // 获取搜索历史\r\n    getHistorywords() {\r\n      let historywords = localStorage.getItem(\"SEARCH\");\r\n      if (!historywords) {\r\n        historywords = [];\r\n        localStorage.setItem(\"SEARCH\", JSON.stringify(historywords));\r\n      } else {\r\n        if (JSON.parse(historywords).length == 0) return;\r\n        for (let i = 0; i < JSON.parse(historywords).length; i++) {\r\n          this.historywords.push(JSON.parse(historywords)[i]);\r\n        }\r\n        localStorage.setItem(\"SEARCH\", JSON.stringify(this.historywords));\r\n      }\r\n    },\r\n\r\n    // 输入框值变化时\r\n    onInput() {\r\n      this.status = 1;\r\n      // console.log(this.value);\r\n      this.axios({\r\n        method: \"GET\",\r\n        url: \"/auto-complete?query=\" + this.value,\r\n      }).then((reslut) => {\r\n        // console.log(\"buquan\", reslut);\r\n        this.autowords = [];\r\n        if (reslut.data.keywords.length == 0) {\r\n          return;\r\n        }\r\n        for (let i = 0; i < reslut.data.keywords.length; i++) {\r\n          this.autowords.push(reslut.data.keywords[i]);\r\n        }\r\n      });\r\n    },\r\n\r\n    // 补全输入值\r\n    changeValue(item) {\r\n      this.value = item;\r\n      for (let i = 0; i < this.historywords.length; i++) {\r\n        if(this.historywords[i]==item){\r\n          this.historywords.splice(i,1)\r\n        }\r\n      }\r\n      this.historywords.unshift(item);\r\n      localStorage.setItem(\"SEARCH\", JSON.stringify(this.historywords));\r\n      this.onSearch();\r\n    },\r\n\r\n    // 确认搜索\r\n    onSearch() {\r\n      this.$toast.loading({\r\n        message: \"加载中...\",\r\n        forbidClick: true,\r\n        duration: 0,\r\n        loadingType: \"spinner\",\r\n      });\r\n      this.axios({\r\n        method: \"GET\",\r\n        url: \"/search?keyword=\" + this.value,\r\n      }).then((reslut) => {\r\n        this.$toast.clear();\r\n        // console.log(reslut);\r\n        this.status = 2;\r\n        this.bookList = reslut.data.books;\r\n        this.bookList.map((v) => [(v.cover = unescape(v.cover.slice(7)))]);\r\n      });\r\n    },\r\n\r\n    // 热门搜索词\r\n    getHotwords() {\r\n      this.axios({\r\n        method: \"GET\",\r\n        url: \"/search-hotwords\",\r\n      }).then((reslut) => {\r\n        this.hotwords = [];\r\n        for (let i = 0; i < 8; i++) {\r\n          this.hotwords.push(reslut.data.searchHotWords[i].word);\r\n        }\r\n      });\r\n    },\r\n\r\n    // 点击书籍\r\n    goDetail(id) {\r\n      this.$store.dispatch(\"detailStore/setBookIdListById\", id);\r\n      this.$toast.loading({\r\n        message: \"加载中...\",\r\n        forbidClick: true,\r\n        duration: 0,\r\n        loadingType: \"spinner\",\r\n      });\r\n      this.axios\r\n        .all([\r\n          this.axios({\r\n            method: \"GET\",\r\n            url: \"/book-info/\" + id,\r\n          }),\r\n          this.axios({\r\n            method: \"GET\",\r\n            url: \"/book-sources?view=summary&book=\" + id,\r\n          }),\r\n        ])\r\n        .then((result) => {\r\n          this.$toast.clear();\r\n          this.$store.dispatch(\"detailStore/setBookDetail\", result[0].data);\r\n          this.$store.dispatch(\r\n            \"detailStore/setBookOriginIdListById\",\r\n            result[1].data[0]._id\r\n          );\r\n          this.$router.push({ name: \"Detail\" });\r\n        })\r\n        .catch((err) => {\r\n          this.$toast.clear();\r\n        });\r\n    },\r\n  },\r\n  watch: {\r\n    value(val) {\r\n      if (val == \"\") {\r\n        this.status = 0;\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Search.vue?vue&type=template&id=b39ff05e&\"\nimport script from \"./Search.vue?vue&type=script&lang=js&\"\nexport * from \"./Search.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}