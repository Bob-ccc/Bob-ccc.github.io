{"version":3,"sources":["webpack:///./node_modules/core-js/internals/create-html.js","webpack:///./node_modules/core-js/modules/es.string.link.js","webpack:///./node_modules/core-js/internals/string-html-forced.js","webpack:///./src/views/History.vue?4063","webpack:///src/views/History.vue","webpack:///./src/views/History.vue?1c1b","webpack:///./src/views/History.vue"],"names":["requireObjectCoercible","quot","module","exports","string","tag","attribute","value","S","String","p1","replace","$","createHTML","forcedStringHTMLMethod","target","proto","forced","link","url","this","fails","METHOD_NAME","test","toLowerCase","split","length","render","_vm","_h","$createElement","_c","_self","staticClass","ref","staticStyle","attrs","on","back","_l","item","index","key","$event","goDetail","_id","cover","_v","_s","title","bookState","historyTitle","_f","time","goChapters","addClassify","staticRenderFns","data","computed","historyData","i","isReaded","splice","methods","$router","go","$store","dispatch","$toast","loading","message","forbidClick","duration","loadingType","axios","method","id","component"],"mappings":"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","file":"js/chunk-d03b3f12.877976a5.js","sourcesContent":["var requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar quot = /\"/g;\n\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\n// https://tc39.github.io/ecma262/#sec-createhtml\nmodule.exports = function (string, tag, attribute, value) {\n  var S = String(requireObjectCoercible(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/string-html-forced');\n\n// `String.prototype.link` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.link\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('link') }, {\n  link: function link(url) {\n    return createHTML(this, 'a', 'href', url);\n  }\n});\n","var fails = require('../internals/fails');\n\n// check the existence of a method, lowercase\n// of a tag and escaping quotes in arguments\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    var test = ''[METHOD_NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  });\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"history\"},[_c('van-nav-bar',{ref:\"toolbar\",staticStyle:{\"background\":\"#f6f6f6\"},attrs:{\"title\":\"阅读记录\",\"left-arrow\":\"\"},on:{\"click-left\":_vm.back}}),_c('div',{staticClass:\"classifyList-box\"},_vm._l((_vm.historyData),function(item,index){return _c('div',{key:index,staticClass:\"list-box\"},[_c('div',{staticClass:\"img-box\",on:{\"click\":function($event){return _vm.goDetail(item._id)}}},[_c('img',{staticClass:\"auto-img\",attrs:{\"src\":item.cover,\"alt\":\"\"}})]),_c('div',{staticClass:\"text-box\",on:{\"click\":function($event){return _vm.goDetail(item._id)}}},[_c('div',{staticClass:\"title-box\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(item.title))])]),_c('div',{staticClass:\"history-title\"},[_vm._v(_vm._s(item.bookState.historyTitle))]),_c('div',{staticClass:\"history-time\"},[_vm._v(\"上次阅读：\"+_vm._s(_vm._f(\"formatDate\")(item.bookState.time,'yyyy-MM-dd hh:mm:ss')))])]),_c('div',{staticClass:\"btn-box\"},[(item.bookState.isAtClassify)?_c('div',{staticClass:\"btn open-btn\",on:{\"click\":function($event){return _vm.goChapters(item)}}},[_vm._v(\"打开\")]):_c('div',{staticClass:\"btn add-btn\",on:{\"click\":function($event){return _vm.addClassify(item)}}},[_vm._v(\"加入书架\")])])])}),0)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"history\">\r\n    <van-nav-bar\r\n      ref=\"toolbar\"\r\n      style=\"background:#f6f6f6\"\r\n      title=\"阅读记录\"\r\n      left-arrow\r\n      @click-left=\"back\"\r\n    />\r\n\r\n    <div class=\"classifyList-box\">\r\n      <div class=\"list-box\" v-for=\"(item,index) in historyData\" :key=\"index\">\r\n        <div class=\"img-box\" @click=\"goDetail(item._id)\">\r\n          <img class=\"auto-img\" :src=\"item.cover\" alt />\r\n        </div>\r\n        <div class=\"text-box\" @click=\"goDetail(item._id)\">\r\n          <div class=\"title-box\">\r\n            <div class=\"title\">{{item.title}}</div>\r\n          </div>\r\n          <div class=\"history-title\">{{item.bookState.historyTitle}}</div>\r\n          <div class=\"history-time\">上次阅读：{{item.bookState.time | formatDate('yyyy-MM-dd hh:mm:ss')}}</div>\r\n        </div>\r\n        <div class=\"btn-box\">\r\n          <div class=\"btn open-btn\" @click=\"goChapters(item)\" v-if=\"item.bookState.isAtClassify\">打开</div>\r\n          <div class=\"btn add-btn\" @click=\"addClassify(item)\" v-else>加入书架</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport \"../assets/less/history.less\";\r\nexport default {\r\n  data() {\r\n    return {};\r\n  },\r\n  computed: {\r\n    historyData() {\r\n      let historyData = Object.assign(\r\n        this.$store.state.bookrackStore.historyData\r\n      );\r\n      for (let i = historyData.length - 1; i >= 0; i--) {\r\n        if (!historyData[i].bookState.isReaded) {\r\n          historyData.splice(i, 1);\r\n        }\r\n      }\r\n      return historyData;\r\n    },\r\n  },\r\n  methods: {\r\n    back() {\r\n      this.$router.go(-1);\r\n    },\r\n\r\n    // 点击打开按钮前往阅读页面\r\n    goChapters(item) {\r\n      this.$store.dispatch(\"detailStore/setBookIdListById\", item._id);\r\n      this.$toast.loading({\r\n        message: \"加载中...\",\r\n        forbidClick: true,\r\n        duration: 0,\r\n        loadingType: \"spinner\",\r\n      });\r\n\r\n      this.axios({\r\n        method: \"GET\",\r\n        url: \"/book-sources?view=summary&book=\" + item._id,\r\n      })\r\n        .then((result) => {\r\n          this.$toast.clear();\r\n          this.$store.dispatch(\r\n            \"detailStore/setBookOriginIdListById\",\r\n            result.data[0]._id\r\n          );\r\n          this.axios({\r\n            method: \"GET\",\r\n            url: \"/book-chapters/\" + this.$store.state.detailStore.bookOriginId,\r\n          })\r\n            .then((result) => {\r\n              this.$store.dispatch(\r\n                \"detailStore/setDirectoryListByLink\",\r\n                result.data.chapters\r\n              );\r\n\r\n              // 获取目标章节\r\n              let chapterDir = this.$store.state.detailStore.directoryList[\r\n                item.bookState.bookOrder\r\n              ];\r\n              // 获取章节目录link\r\n              let link = chapterDir.link;\r\n              // 设置章节\r\n              this.$store.dispatch(\"chaptersStore/setChaptersList\", chapterDir);\r\n              this.axios({\r\n                method: \"GET\",\r\n                url: \"/chapters/\" + encodeURIComponent(link),\r\n              }).then((result) => {\r\n                this.$toast.clear();\r\n                this.$store.dispatch(\r\n                  \"chaptersStore/setChapterText\",\r\n                  result.data.chapter\r\n                );\r\n                let state = Object.assign(item.bookState);\r\n                // 设置书籍当前的阅读标题\r\n                state.historyTitle = chapterDir.title;\r\n                // 记录本书籍当前阅读时间\r\n                state.time = new Date();\r\n                //isReaded属性更新为true\r\n                state.isReaded = true;\r\n\r\n                // 更新书籍状态、更新阅读记录书籍状态\r\n                this.$store\r\n                  .dispatch(\"detailStore/setBookDetailBookState\", state)\r\n                  .then((res) => {\r\n                    this.$store.dispatch(\"bookrackStore/addHistoryData\", res);\r\n                  });\r\n                this.$router.push({ name: \"Chapters\" });\r\n              });\r\n            })\r\n            .catch((err) => {\r\n              this.$toast.clear();\r\n            });\r\n        })\r\n        .catch((err) => {\r\n          this.$toast.clear();\r\n        });\r\n      //console.log(item);\r\n    },\r\n\r\n    // 点击加入书架\r\n    addClassify(item) {\r\n      // 更新书籍状态\r\n      this.$store.dispatch(\"bookrackStore/setHistoryDataBookState\", item);\r\n    },\r\n\r\n    // 点击书籍\r\n    goDetail(id) {\r\n      this.$store.dispatch(\"detailStore/setBookIdListById\", id);\r\n      this.$toast.loading({\r\n        message: \"加载中...\",\r\n        forbidClick: true,\r\n        duration: 0,\r\n        loadingType: \"spinner\",\r\n      });\r\n      this.axios\r\n        .all([\r\n          this.axios({\r\n            method: \"GET\",\r\n            url: \"/book-info/\" + id,\r\n          }),\r\n          this.axios({\r\n            method: \"GET\",\r\n            url: \"/book-sources?view=summary&book=\" + id,\r\n          }),\r\n        ])\r\n        .then((result) => {\r\n          this.$toast.clear();\r\n          this.$store.dispatch(\"detailStore/setBookDetail\", result[0].data);\r\n          this.$store.dispatch(\r\n            \"detailStore/setBookOriginIdListById\",\r\n            result[1].data[0]._id\r\n          );\r\n          this.$router.push({ name: \"Detail\" });\r\n        })\r\n        .catch((err) => {\r\n          this.$toast.clear();\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./History.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./History.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./History.vue?vue&type=template&id=ae6c3646&\"\nimport script from \"./History.vue?vue&type=script&lang=js&\"\nexport * from \"./History.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}